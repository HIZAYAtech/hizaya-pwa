<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>HIZAYA</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <!-- Tailwind (style rapide) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ⚙️ CONFIG SUPABASE -->
    <script>
      window.__SUPABASE_URL__ = "<<< https://XXXXXX.supabase.co >>>";
      window.__SUPABASE_ANON_KEY__ = "<<< SUPABASE_ANON_KEY >>>";
      // Supabase -> Auth -> URL de redirection : ajoute ton URL GitHub Pages exacte
      // ex: https://<username>.github.io/<repo>/
    </script>

    <!-- ⚙️ CONFIG MQTT (HiveMQ Cloud privé) -->
    <script>
      // URL WSS de ton cluster (port 8884 + /mqtt)
      window.__MQTT_URL__ = "<<< wss://xxxxx.s1.eu.hivemq.cloud:8884/mqtt >>>";
      window.__MQTT_USER__ = "<<< MQTT_USERNAME >>>";
      window.__MQTT_PASS__ = "<<< MQTT_PASSWORD >>>";
    </script>
  </head>
  <body class="min-h-screen text-slate-900 bg-gradient-to-b from-slate-50 to-white">
    <header class="sticky top-0 z-10 bg-white/70 backdrop-blur border-b border-slate-200">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-2xl bg-slate-900 text-white grid place-items-center font-bold">H</div>
          <span class="font-semibold tracking-tight">HIZAYA</span>
        </div>
        <div class="flex items-center gap-3 text-sm">
          <span id="who" class="text-slate-600">Hors ligne</span>
          <button id="btnLogout" class="hidden px-3 py-1.5 rounded-xl bg-slate-100 hover:bg-slate-200">Déconnexion</button>
        </div>
      </div>
    </header>

    <!-- Page Login -->
    <main id="page-login" class="max-w-md mx-auto px-4 pt-10">
      <div class="bg-white border border-slate-200 rounded-3xl shadow-sm p-6">
        <div class="flex items-center gap-3 mb-3">
          <div class="w-10 h-10 rounded-2xl bg-gray-900 text-white grid place-items-center font-semibold">H</div>
          <h1 class="text-[22px] font-semibold tracking-[-0.01em] text-gray-900">HIZAYA</h1>
        </div>
        <p class="text-sm text-slate-600 mb-5">Connecte-toi (Google) pour gérer ton Master et ses Slaves.</p>
        <div class="space-y-3">
          <button id="btnGoogle" class="w-full px-4 py-2 rounded-xl bg-slate-900 text-white hover:opacity-90 flex items-center justify-center gap-2">
            <!-- Icône Google -->
            <svg width="18" height="18" viewBox="0 0 533.5 544.3"><path fill="#4285F4" d="M533.5 278.4c0-18.6-1.7-37-5.3-54.9H272.1v103.9h146.9c-6.3 34.2-25.2 63.1-53.7 82.5v68h86.8c50.8-46.8 81.4-115.8 81.4-199.5z"/><path fill="#34A853" d="M272.1 544.3c72.9 0 134.1-24.1 178.8-65.3l-86.8-68c-24.1 16.2-55 25.7-92 25.7-70.7 0-130.6-47.7-152.1-111.9H30.7v70.3c44.3 88 135.6 149.2 241.4 149.2z"/><path fill="#FBBC05" d="M120 324.8c-10.6-31.9-10.6-66.9 0-98.8V155.7H30.7c-43.1 86.1-43.1 187.5 0 273.6l89.3-70.3z"/><path fill="#EA4335" d="M272.1 107.7c39.7-.6 77.7 13.7 107 40l80-80C416.2 23.6 345.7-1.6 272.1 0 166.3 0 75 61.3 30.7 149.4l89.3 70.3c21.4-64.2 81.4-112 152.1-112z"/></svg>
            Se connecter avec Google
          </button>
          <div class="text-xs text-slate-500 text-center">
            Pense à ajouter l’URL GitHub Pages dans Supabase &gt; Auth &gt; URL de redirection.
          </div>
        </div>
      </div>
    </main>

    <!-- Page App -->
    <main id="page-main" class="hidden max-w-6xl mx-auto px-4 py-6 space-y-6">
      <section class="flex items-end justify-between">
        <div>
          <h2 class="text-3xl font-semibold">Bienvenue 👋</h2>
          <p class="text-slate-600">Gère tes Masters et leurs Slaves depuis une interface simple.</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="btnConnect" class="px-3 py-2 rounded-xl bg-sky-600 text-white hover:bg-sky-700">Connexion MQTT</button>
          <button id="btnDisconnect" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200">Déconnexion MQTT</button>
        </div>
      </section>

      <section class="bg-white border border-slate-200 rounded-2xl shadow-sm p-4">
        <h3 class="font-medium mb-3">Ajouter un Master</h3>
        <div class="flex flex-col sm:flex-row gap-2">
          <input id="mid" class="flex-1 px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring focus:ring-sky-200" placeholder="MASTER_ID (ex: A842E3917578)" />
          <input id="mname" class="flex-1 px-3 py-2 rounded-xl border border-slate-300 focus:outline-none focus:ring focus:ring-sky-200" placeholder="Nom (ex: Atelier)" />
          <button id="btnAddMaster" class="px-3 py-2 rounded-xl bg-slate-900 text-white">ADD</button>
        </div>
      </section>

      <section id="masters" class="grid grid-cols-1 gap-6"></section>

      <section class="bg-white border border-slate-200 rounded-2xl shadow-sm p-4">
        <h3 class="font-medium mb-2">Console</h3>
        <pre id="log" class="text-xs bg-slate-50 p-3 rounded-xl overflow-auto max-h-64"></pre>
      </section>
    </main>

    <!-- Supabase SDK (ESM) -->
    <script type="module" src="supabase-auth.js"></script>
    <!-- MQTT.js (browser) -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <!-- App -->
    <script defer src="app.js"></script>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js').catch(()=>{}); });
      }
    </script>
  </body>
</html>
