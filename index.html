<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HIZAYA • Remote Power</title>
<meta name="theme-color" content="#0ea5e9" />
<style>
:root { --bg:#0b1220; --fg:#e6e9f0; --muted:#9aa3b2; --card:#121a2b; --accent:#3aa0ff; }
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font:16px system-ui,Segoe UI,Roboto,Arial}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #1c2742}
.btn{padding:8px 12px;border:1px solid #2a3a60;background:#14203a;color:var(--fg);border-radius:10px;cursor:pointer}
.btn.primary{background:var(--accent);color:#001b2e;border:none}
main{max-width:980px;margin:24px auto;padding:0 16px}
.card{background:var(--card);border:1px solid #1c2742;border-radius:16px;padding:16px;margin-bottom:16px}
.row{display:flex;gap:8px;flex-wrap:wrap}
input,select{background:#0f1627;border:1px solid #273456;color:var(--fg);padding:10px;border-radius:10px}
.muted{color:var(--muted)}
.hidden{display:none}
.log{font-family:ui-monospace,Menlo,monospace;font-size:13px;white-space:pre-wrap}
.pill{padding:2px 8px;border-radius:999px;background:#1f2b47;border:1px solid #2f406a}
select#cmd-master{min-width:220px}
#pairing-info{padding:8px 12px;border:1px solid #2a3a60;border-radius:10px}
</style>
</head>
<body>
<header>
<strong>HIZAYA • Remote Power</strong>
<div id="auth-area">
<button class="btn" id="btn-login-google">Connexion Google</button>
<button class="btn hidden" id="btn-logout">Se déconnecter</button>
</div>
</header>


<main>
<section class="card" id="whoami" aria-live="polite">Non connecté.</section>


<section class="card hidden" id="pairing">
<h3>Appairage (code 6 chiffres)</h3>
<div class="row">
<button class="btn primary" id="btn-gen-code">Générer un code (10 min)</button>
<div id="pairing-info" class="muted"></div>
</div>
<p class="muted">Donne ce code au MASTER pendant la config Wi‑Fi. Il s’ajoutera automatiquement à ton compte.</p>
</section>


<section class="card hidden" id="devices">
<h3>Mes MASTERs</h3>
<div class="row">
<input id="new-device-id" placeholder="MASTER ID (ex: MASTER_001)" />
<input id="new-device-key" placeholder="Clé secrète (garde-la pour l'ESP32)" />
<input id="new-device-name" placeholder="Nom (optionnel)" />
<button class="btn primary" id="btn-add-device">+ Ajouter</button>
</div>
<div id="device-list" style="margin-top:12px"></div>
</section>


<section class="card hidden" id="commands">
<h3>Envoyer un ordre</h3>
<div class="row">
<select id="cmd-master"></select>
<input id="cmd-peer" placeholder="Peer MAC (optionnel)" />
<select id="cmd-action">
<option>POWER_ON</option>
<option>POWER_OFF</option>
<option>PULSE</option>
<option>RESET</option>
</select>
<input id="cmd-payload" placeholder='Payload JSON (ex: {"ms":500})' />
<button class="btn primary" id="btn-send-cmd">Envoyer</button>
</div>
<p class="muted">Les ordres expirent par défaut au bout de 10 minutes.</p>
</section>


<section class="card">
<h3>Journal</h3>
<div id="log" class="log">(prêt)</div>
</section>
</main>


<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'


// ======= CONFIG — À REMPLACER =======
const SUPABASE_URL = 'https://zeknluovgbsmtgupwkvo.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpla25sdW92Z2JzbXRndXB3a3ZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3MjY2NjIsImV4cCI6MjA3NDMwMjY2Mn0.AjCTWEAGBBhi5liJv8LBCK_baqivRlDIYMbFcDeA_q4'
const REDIRECT_URL = 'https://hizayatech.github.io/hizaya-pwa/'
// ====================================


const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
const $ = (q) => document.querySelector(q)
const log = (m) => { const el = $('#log'); el.textContent += `\n${new Date().toLocaleTimeString()} ${m}`; el.scrollTop = el.scrollHeight }


const ui = {
who: $('#whoami'),
pairingCard: $('#pairing'),
btnGenCode: $('#btn-gen-code'),
pairingInfo: $('#pairing-info'),
devicesCard: $('#devices'),
commandsCard: $('#commands'),
btnLoginGoogle: $('#btn-login-google'),
btnLogout: $('#btn-logout'),
btnAddDevice: $('#btn-add-device'),
deviceList: $('#device-list'),
cmdMaster: $('#cmd-master'),
</html>
